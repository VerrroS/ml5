<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bildklassifikation mit ml5</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="animations.css"> 
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.0.0/p5.min.js"></script>
  <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
  <script src="https://code.iconify.design/2/2.1.0/iconify.min.js"></script>
</head>

<body class="container mt-3">
    


<h1>Dokumentation<a href="https://github.com/VerrroS/ml5" id="github" target="_blank"><span class="iconify" data-icon="akar-icons:github-fill"></span></a></h1>
<h2>Technische Dokumentation</h2>
<p>FÃ¼r die Umsetzung der Aufgabe habe ich folgende Tools verwendet:</p>
<ul>
<li>
<p><strong><a href="https://p5js.org/">p5.js</a></strong></p>
<p>p5.js habe ich verwendet um die Bilder zu laden und zu verarbeiten</p>
</li>
<li>
<p><strong><a href="https://ml5js.org/">ml5.js</a></strong></p>
<p>ml5 habe ich verwendet um die Bilder zu verarbeiten</p>
</li>
<li>
<p><strong><a href="https://getbootstrap.com/">Bootstrap</a></strong></p>
<p>Bootstrap habe ich verwendet um das User Interface zu gestalten</p>
</li>
</ul>
<h2>Fachliche Dokumentation</h2>
<h3>Ansatz</h3>
<p>Um eine schnelle und leichtgewichtige LÃ¶sung zu erstellen habe ich mich dazu entschieden die Klassifikation auf 
einer statischen WebPage zu implementieren. Ich nutze dabei kein Framework sondern schreibe nur HTML, CSS und JavaScript.</p>
<p><strong>Visualisieren</strong></p>
<p>Da mir der Look und die Handhabung von Frameworks wie Plotly nicht gefÃ¤llt und in diesem Falle eine visualisierung der Ergebnisse 
mit CSS und Javascript einfach mÃ¶glich ist, habe ich mich gegen ein Framework entschieden. Mit Css habe ich die volle 
Kontrolle Ã¼ber den Look und kann die Seite auch fÃ¼r mobile GerÃ¤te anpassen.</p>
<h3>Logik</h3>
<p><strong>Klassifikation mit ml5</strong></p>
<p>Zuerst wird der ml5 Classifier mit preload geladen</p>
<pre><code>function preload() {
let classifier = ml5.imageClassifier('MobileNet');
}
</code></pre>
<p>Um p5 zu starten wird die funktion setup aufgerufen. Da ich kein Canvas nutze um das Bild anzuzeigen rufe ich die Funktion noCanvas(); darin auf</p>
<pre><code>function setup(){
noCanvas();
}
</code></pre>
<p>Wenn ein Bild angeclick oder hochgeladen wird, wird die Funktion changeImage() mit dem Parameter url aufgerufen. Die Funktion setzt zuerst das Ladeicon auf der rechten Seite auf aktiv. So bekommt der Nuetzer das Feedback, dass der Input angekommen ist. Das anfÃ¤ngliche Kamera Icon in der Mitte vom grauen Kasten links wird unsichtbar gestellt, da der Nutzer nun gesehen hat, an welche Stelle er ein Bild per Drak and Drop hineinziehen kann. Mit loadImage wird nun das Bild and ml5 weitergegeben. Ist es erfolgreich geladen worden wird es links angezeigt. Gibt es beim laden einen Fehler, wird eine Warnung angezeigt.</p>
<pre><code>function changeImage(url){
toggleLoader();
img_icon.style.display = "none";
img = loadImage(url, () =&gt; loading_sucessful(url), () =&gt; loading_failed());
}
</code></pre>
<p><strong>Visualisierung mit JS und CSS</strong></p>
<p>Ist die Klassifikation abgeschlossen oder ein Fehler tritt auf wird die Funktion gotResult aufgerufen. Bei einem Fehler gibt es eine Warnung mit der entsprechenden Fehlermeldung. FÃ¼r die Visualisierung der Ergebnisse habe ich die Funktion createBarCart() erstellt. Diese wird fÃ¼r jedes Ergebnis mit den Parametern percent und lable_txt aufgerufen. </p>
<pre><code>function gotResult(error, results) {
if (error) {
    console.error(error);
    alert("Error: " + error);
}
results.forEach(element =&gt; {
percent = element["confidence"] * 100;
createBarCart(percent, element["label"]);
});
}

function createBarCart(percent, lable_txt){
cleanUpBars();
bar_parent = createBar();
lable_confidence = createlable(percent.toFixed(2) + "% Confidence", true);
lable_txt = createlable(lable_txt);
bar_parent.appendChild(lable_confidence);
plot.appendChild(lable_txt); 
bar_child = createBar(true);
bar_parent.appendChild(bar_child);
plot.appendChild(bar_parent);
}
</code></pre>
<p>In der Funktion createBar() wird nun die LÃ¤nge der Bar im style property definiert.</p>
<pre><code>function createBar(isChild = false){
    var newdiv = document.createElement("div");
    if (isChild){
        newdiv.style.width = `${percent}%`;
        }
    else {
        newdiv.className = "bar_parent";
    }
    return newdiv;
}
</code></pre>
<p><strong>Fehlerbehandlung</strong></p>
<p>Der Upload wird an verschiedenen Stellen auf das passende Format geprÃ¼ft. Bei der Verwendung des Input Buttons werden nur die Dateiformate png und jpg akzeptiert.</p>
<pre><code>&lt;input class="mt-2" id="image_input" type='file' accept="image/png, image/jpg"/&gt;
</code></pre>
<p>Beim Upload der Datei wird dann nocheinmal im JS geprÃ¼ft ob es sich um eine Bilddatei handelt.</p>
<pre><code>if (uploaded_image.startsWith("data:image")){
    changeImage(uploaded_image);
    } else {
    alert("Please upload an image");
}
</code></pre>
<h3>Resultate</h3>
<h3>Quellen</h3>
<ul>
<li><a href="https://learn.ml5js.org/#/tutorials/hello-ml5">ml5 Tutorial</a></li>
<li><a href="https://p5js.org/reference">p5 Referenzen</a></li>
</ul>

<footer class="mt-3">
    <a href="./">Zurück zum Bildklassifizierer</a>
</footer>


</body>


<script src="functions.js"></script>
<script src="main.js"></script>
</html>